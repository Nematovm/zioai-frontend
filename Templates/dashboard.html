<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ZiyoAI - Dashboard</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Saira:ital,wght@0,100..900;1,100..900&display=swap" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto+Slab:wght@100..900&display=swap" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css" />
    <link rel="stylesheet" href="../Static/dashboard.css" />
    <link rel="stylesheet" href="../Static/profile.css">
    <link rel="stylesheet" href="../Static/dark-mode.css">
    <link rel="stylesheet" href="../Static/responsive.css">
  </head>
  <body>
    <!-- Logout Modal -->
    <div class="logout-modal-overlay" id="logoutModal">
      <div class="logout-modal">
        <div class="logout-modal-icon">
          <i class="bi bi-box-arrow-right"></i>
        </div>
        <h3>Log Out?</h3>
        <p>Are you sure you want to log out of your account?</p>
        <div class="logout-modal-buttons">
          <button class="logout-modal-btn cancel" id="cancelLogout">Cancel</button>
          <button class="logout-modal-btn confirm" id="confirmLogout">Log Out</button>
        </div>
      </div>
    </div>

    <!-- Spinner -->
    <div class="spinner-wrapper">
      <div class="spinner-grow" role="status">
        <span class="visually-hidden">Loading...</span>
      </div>
    </div>

    <!-- MOTIVATSIYA NOTIFICATION -->
    <div id="motivationToast" class="motivation-toast">
      <div class="motivation-icon">ğŸŒŸ</div>
      <div class="motivation-text"></div>
      <button class="motivation-close" onclick="closeMotivation()">Ã—</button>
    </div>

    <!-- Sidebar -->
    <aside class="sidebar">
      <header class="sidebar-header">
        <div class="nav-left">
          <div class="main-logo"><i class="bi bi-stars"></i></div>
          <a class="navbar-brand"><h3 class="nav-title">ZiyoAI</h3></a>
        </div>
        <button class="toggler sidebar-toggler">
          <span class="material-symbols-outlined">chevron_left</span>
        </button>
        <button class="toggler menu-toggler">
          <span class="material-symbols-outlined">menu</span>
        </button>
      </header>
      <nav class="sidebar-nav">
        <ul class="nav-list primary-nav">
          <li class="nav-item">
            <a class="nav-link active" data-tool="dashboard">
              <span class="nav-icon material-symbols-outlined">dashboard</span>
              <span class="nav-lebel">Dashboard</span>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" data-tool="homework">
              <span class="nav-icon material-symbols-outlined">book_ribbon</span>
              <span class="nav-lebel">Homework Fixer</span>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" data-tool="grammar">
              <span class="nav-icon material-symbols-outlined">ink_pen</span>
              <span class="nav-lebel">Grammar Checker</span>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" data-tool="vocabulary">
              <span class="nav-icon material-symbols-outlined">book_3</span>
              <span class="nav-lebel">Vocabulary Builder</span>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" data-tool="quiz">
              <span class="nav-icon material-symbols-outlined">quiz</span>
              <span class="nav-lebel">Quiz Generator</span>
            </a>
          </li>
          <!-- <li class="nav-item">
            <a class="nav-link" data-tool="calculate">
              <span class="nav-icon material-symbols-outlined">calculate</span>
              <span class="nav-lebel">Math Solver</span>
            </a>
          </li> -->
          <li class="nav-item">
            <a class="nav-link" data-tool="clinical_notes">
              <span class="nav-icon material-symbols-outlined"
                >clinical_notes</span
              >
              <span class="nav-lebel">Study Assistant</span>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" data-tool="article">
              <span class="nav-icon material-symbols-outlined">article</span>
              <span class="nav-lebel">Resume Builder</span>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" data-tool="chat_bubble">
              <span class="nav-icon material-symbols-outlined"
                >chat_bubble</span
              >
              <span class="nav-lebel">IELTS Feedback</span>
            </a>
          </li>
        </ul>
        <ul class="nav-list secondary-nav">
          <li class="nav-item">
            <a class="nav-link" data-tool="profile">
              <span class="nav-icon material-symbols-outlined">account_circle</span>
              <span class="nav-lebel">Profile</span>
            </a>
          </li>
          <li class="nav-item">
            <a href="javascript:void(0);" class="nav-link" id="logoutBtn">
              <span class="nav-icon material-symbols-outlined">logout</span>
              <span class="nav-lebel">Logout</span>
            </a>
          </li>
        </ul>
      </nav>
    </aside>
      

        <!-- Header Section - YANGILANGAN -->
    <section class="header-section">
      <div class="header_section_left">
        <h2 id="headerTitle">Welcome back, <span id="userName">Student</span>!</h2>
      <p id="headerSubtitle">Select a tool below to get started</p>
      </div>

    
<!-- Tomato Icon Button -->
<button class="tomato-icon-btn" onclick="toggleTimerDropdown()">ğŸ…</button>

<!-- Timer Dropdown -->
<div class="timer-dropdown" id="timerDropdown">
  <div class="timer-display" id="miniTimerDisplay">25:00</div>
  <div class="timer-controls">
    <button class="timer-btn start" id="miniStartBtn" onclick="startMiniTimer()">
      <i class="bi bi-play-fill"></i>
    </button>
    <button class="timer-btn pause" id="miniPauseBtn" onclick="pauseMiniTimer()" style="display: none;">
      <i class="bi bi-pause-fill"></i>
    </button>
    <button class="timer-btn reset" onclick="resetMiniTimer()">
      <i class="bi bi-arrow-clockwise"></i>
    </button>
    <button class="timer-btn settings" onclick="openTimerSettings()">
      <i class="bi bi-gear-fill"></i>
    </button>
  </div>
  <div class="timer-label" id="timerLabel">Pomodoro</div>
</div>

<!-- Timer Settings Modal -->
<div class="timer-modal-overlay" id="timerSettingsModal">
  <div class="timer-modal">
    <div class="timer-modal-header">
      <h3>âš™ï¸ Timer Settings</h3>
      <button class="timer-modal-close" onclick="closeTimerSettings()">Ã—</button>
    </div>
    <div class="timer-modal-body">
      <div class="setting-group">
        <label>ğŸ… Pomodoro Duration</label>
        <div class="time-selector">
          <button class="time-option" onclick="setPomodoroTime(15)">15 min</button>
          <button class="time-option active" onclick="setPomodoroTime(25)">25 min</button>
          <button class="time-option" onclick="setPomodoroTime(30)">30 min</button>
          <button class="time-option" onclick="setPomodoroTime(45)">45 min</button>
        </div>
      </div>
      <div class="setting-group">
        <label>â˜•ï¸ Break Duration</label>
        <div class="time-selector">
          <button class="time-option active" onclick="setBreakTime(5)">5 min</button>
          <button class="time-option" onclick="setBreakTime(10)">10 min</button>
          <button class="time-option" onclick="setBreakTime(15)">15 min</button>
          <button class="time-option" onclick="setBreakTime(20)">20 min</button>
        </div>
      </div>
      <div class="setting-group">
        <label>ğŸ”” Sound Notification</label>
        <label class="switch">
          <input type="checkbox" id="soundToggle" checked>
          <span class="slider"></span>
        </label>
      </div>
    </div>
    <div class="timer-modal-footer">
      <button class="timer-modal-btn save" onclick="saveTimerSettings()">
        <i class="bi bi-check-circle"></i> Save Settings
      </button>
    </div>
  </div>
</div>

<!-- Timer Notification Modal -->
<div class="timer-notification-overlay" id="timerNotification">
  <div class="timer-notification">
    <div class="timer-notification-icon" id="notificationIcon">ğŸ…</div>
    <h3 id="notificationTitle">Pomodoro Complete!</h3>
    <p id="notificationMessage">Great work! Time for a break?</p>
    <div class="timer-notification-buttons">
      <button class="notification-btn yes" onclick="startBreakTimer()">
        <i class="bi bi-check-circle"></i> Yes, Start Break
      </button>
      <button class="notification-btn no" onclick="restartPomodoro()">
        <i class="bi bi-arrow-repeat"></i> No, Continue Working
      </button>
    </div>
  </div>
</div>
    </section>



    <!-- Main Section -->
     <main>
      <!-- Dashboard View -->
      <div class="tool-content active" id="dashboard-content">
        <div class="dashboard-exp">
          <div class="rocket">ğŸš€</div>
          <h1>Welcome to Ziyo AI</h1>
          <p>Your all-in-one AI-powered education platform. Choose any tool from the sidebar to start your learning journey!</p>
        </div>
        <div class="tools-grid">
          <div class="tool-card gradient-1" data-tool="homework">
            <div class="tool-card-icon">ğŸ“š</div>
            <h3>Homework Fixer</h3>
            <p>
              Paste your homework and get instant corrections with explanations
            </p>
          </div>

          <div class="tool-card gradient-2" data-tool="timer">
            <div class="tool-card-icon">â±ï¸</div>
            <h3>Study Timer</h3>
            <p>Pomodoro timer to help you stay focused and productive</p>
          </div>

          <div class="tool-card gradient-3" data-tool="grammar">
            <div class="tool-card-icon">âœï¸</div>
            <h3>Grammar Checker</h3>
            <p>Check and improve your grammar, spelling, and writing style</p>
          </div>

          <div class="tool-card gradient-4" data-tool="vocabulary">
            <div class="tool-card-icon">ğŸ“–</div>
            <h3>Vocabulary Builder</h3>
            <p>Learn new words and expand your vocabulary with examples</p>
          </div>
        </div>
      </div>

      <!-- Homework Fixer Tool - IMAGE UPLOAD QUSHILGAN -->
<!-- HOMEWORK FIXER TOOL - TO'LIQ YANGILANGAN -->
<div class="tool-content" id="homework-content">
  <div class="tool-interface">
    <h4 style="margin-bottom: 15px; color: #1f2937">Your Homework</h4>
    
    <!-- âœ… TIL TANLASH - ENG YUQORIDA -->
    <div class="language-selector" style="margin-bottom: 20px;">
      <label for="homework-language">ğŸŒ Til / Language / Ğ¯Ğ·Ñ‹Ğº:</label>
      <select id="homework-language" class="language-dropdown">
        <option value="uz" selected>ğŸ‡ºğŸ‡¿ O'zbek</option>
        <option value="ru">ğŸ‡·ğŸ‡º Ğ ÑƒÑÑĞºĞ¸Ğ¹</option>
        <option value="en">ğŸ‡¬ğŸ‡§ English</option>
      </select>
    </div>
    
    <!-- Tab Buttons -->
    <div style="display: flex; gap: 10px; margin-bottom: 20px; border-bottom: 2px solid #e5e7eb; padding-bottom: 10px;">
      <button 
        class="tab-btn active linear-act-bc" 
        onclick="switchHomeworkTab('text')"
        id="textTabBtn"
        style="flex: 1; padding: 12px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; transition: all 0.3s;">
        <i class="bi bi-pencil-square"></i> Type Text
      </button>
      <button 
        class="tab-btn bg-bc" 
        onclick="switchHomeworkTab('image')"
        id="imageTabBtn"
        style="flex: 1; padding: 12px; background: #f3f4f6; color: #6b7280; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; transition: all 0.3s;">
        <i class="bi bi-image"></i> Upload Image
      </button>
    </div>

    <!-- Text Input Tab -->
    <div id="textInputTab">
      <textarea
        placeholder="Paste your homework here..."
        id="homeworkInput"
      ></textarea>
    </div>

    <!-- Image Upload Tab -->
    <div id="imageInputTab" style="display: none;">
      <div style="border: 3px dashed #d1d5db; border-radius: 12px; padding: 40px; text-align: center; background: #f9fafb; cursor: pointer;" onclick="document.getElementById('homeworkImageInput').click()">
        <i class="bi bi-cloud-upload" style="font-size: 48px; color: #9ca3af; margin-bottom: 15px;"></i>
        <p style="color: #6b7280; font-size: 16px; margin: 10px 0;">Click to upload or drag and drop</p>
        <p style="color: #9ca3af; font-size: 14px;">PNG, JPG, JPEG (MAX. 5MB)</p>
        <input 
          type="file" 
          id="homeworkImageInput" 
          accept="image/*" 
          style="display: none;"
          onchange="handleImageUpload(event)">
      </div>
      
      <!-- Image Preview -->
      <div id="imagePreview" style="display: none; margin-top: 20px; text-align: center;">
        <img id="previewImg" style="max-width: 100%; max-height: 400px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
        <p style="margin-top: 10px; color: #6b7280;" id="imageFileName"></p>
        <button onclick="removeImage()" style="margin-top: 10px; padding: 8px 20px; background: #ef4444; color: white; border: none; border-radius: 8px; cursor: pointer;">
          <i class="bi bi-trash"></i> Remove Image
        </button>
      </div>
    </div>

    <button onclick="fixHomework()" style="margin-top: 20px;">
      <i class="bi bi-magic"></i> Fix My Homework
    </button>
    
    <div class="result-box" id="homeworkResult" style="display: none">
      <h5 style="color: #1f2937; margin-bottom: 10px">
        Corrected Homework:
      </h5>
      <div id="homeworkOutput"></div>
    </div>
  </div>
</div>

<!-- GRAMMAR CHECKER TOOL -->
<div class="tool-content" id="grammar-content">
  <div class="tool-interface">
    <h4 style="margin-bottom: 15px; color: #1f2937">Your Text</h4>
    
    <!-- âœ… TIL TANLASH -->
    <div class="language-selector" style="margin-bottom: 20px;">
      <label for="grammar-language">ğŸŒ Til / Language / Ğ¯Ğ·Ñ‹Ğº:</label>
      <select id="grammar-language" class="language-dropdown">
        <option value="uz" selected>ğŸ‡ºğŸ‡¿ O'zbek</option>
        <option value="ru">ğŸ‡·ğŸ‡º Ğ ÑƒÑÑĞºĞ¸Ğ¹</option>
        <option value="en">ğŸ‡¬ğŸ‡§ English</option>
      </select>
    </div>
    
    <textarea
      placeholder="Paste your text here to check grammar..."
      id="grammarInput"
    ></textarea>
    <button onclick="checkGrammar()">
      <i class="bi bi-check2-circle"></i> Check Grammar
    </button>
    <div class="result-box" id="grammarResult" style="display: none">
      <h5 style="color: #1f2937; margin-bottom: 10px">
        Grammar Check Results:
      </h5>
      <div id="grammarOutput"></div>
    </div>
  </div>
</div>

<!-- VOCABULARY BUILDER TOOL -->
<div class="tool-content" id="vocabulary-content">
  <div class="tool-interface">
    <h4 style="margin-bottom: 15px; color: #1f2937">Enter a Word</h4>
    
    <!-- âœ… TIL TANLASH -->
    <div class="language-selector" style="margin-bottom: 20px;">
      <label for="vocab-language">ğŸŒ Til / Language / Ğ¯Ğ·Ñ‹Ğº:</label>
      <select id="vocab-language" class="language-dropdown">
        <option value="uz" selected>ğŸ‡ºğŸ‡¿ O'zbek</option>
        <option value="ru">ğŸ‡·ğŸ‡º Ğ ÑƒÑÑĞºĞ¸Ğ¹</option>
        <option value="en">ğŸ‡¬ğŸ‡§ English</option>
      </select>
    </div>
    
    <input
      type="text"
      placeholder="Type a word to learn..."
      id="vocabInput"
      style="
        width: 100%;
        padding: 15px;
        border: 2px solid #e5e7eb;
        border-radius: 8px;
        font-size: 15px;
      "
    />
    <button onclick="buildVocab()">
      <i class="bi bi-search"></i> Learn Word
    </button>
    <div class="result-box" id="vocabResult" style="display: none">
      <h5 style="color: #1f2937; margin-bottom: 10px">
        Word Information:
      </h5>
      <div id="vocabOutput"></div>
    </div>
  </div>
</div>

<!-- QUIZ GENERATOR TOOL -->
<div class="tool-content" id="quiz-content">
  <div class="tool-interface">
    <h4 style="margin-bottom: 15px; color: #1f2937">Quiz Generator</h4>
    
    <!-- Quiz Input Form -->
    <div id="quizInputForm">
      <!-- TIL TANLASH -->
      <div class="language-selector" style="margin-bottom: 20px;">
        <label for="quiz-language">ğŸŒ Til / Language / Ğ¯Ğ·Ñ‹Ğº:</label>
        <select id="quiz-language" class="language-dropdown">
          <option value="uz" selected>ğŸ‡ºğŸ‡¿ O'zbek</option>
          <option value="ru">ğŸ‡·ğŸ‡º Ğ ÑƒÑÑĞºĞ¸Ğ¹</option>
          <option value="en">ğŸ‡¬ğŸ‡§ English</option>
        </select>
      </div>

      <textarea
        placeholder="Paste your article or text here to generate quiz questions..."
        id="quizArticleInput"
        style="min-height: 200px;"
      ></textarea>

      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 20px;">
        <div>
          <label style="display: block; margin-bottom: 8px; color: #4b5563; font-weight: 600;">
            ğŸ”¢ Savollar Soni / Questions
          </label>
          <select id="quizQuestionCount" class="language-dropdown">
            <option value="1">1 ta savol</option>
            <option value="3" selected>3 ta savol</option>
            <option value="5">5 ta savol</option>
            <option value="10">10 ta savol</option>
          </select>
        </div>

        <div>
          <label style="display: block; margin-bottom: 8px; color: #4b5563; font-weight: 600;">
            âš¡ Qiyinchilik / Difficulty
          </label>
          <select id="quizDifficulty" class="language-dropdown">
            <option value="easy">Oson / Easy</option>
            <option value="medium" selected>O'rtacha / Medium</option>
            <option value="hard">Qiyin / Hard</option>
          </select>
        </div>
      </div>

      <button onclick="generateQuizQuestions()" style="margin-top: 20px; width: 100%;">
        <i class="bi bi-magic"></i> Generate Quiz
      </button>

      <div style="margin-top: 15px; padding: 15px; background: linear-gradient(135deg, #667eea15, #764ba215); border-radius: 12px; border-left: 4px solid #667eea;">
        <p style="margin: 0; color: #4b5563; font-size: 14px;">
          ğŸ’¡ <strong>Maslahat:</strong> Matn qanchalik batafsil bo'lsa, savollar shunchalik qiziqarli bo'ladi!
        </p>
      </div>
    </div>

    <!-- Quiz Questions Section -->
    <div id="quizQuestionsSection" style="display: none; margin-top: 30px;">
      <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 20px; border-radius: 12px; color: white; margin-bottom: 20px;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
          <div style="display: flex; align-items: center; gap: 10px;">
            <i class="bi bi-clock" style="font-size: 20px;"></i>
            <span style="font-size: 18px; font-weight: 600;" id="quizTimer">0:00</span>
          </div>
          <div style="font-size: 16px; font-weight: 600;">
            Savol <span id="quizCurrentQuestion">1</span>/<span id="quizTotalQuestions">0</span>
          </div>
        </div>
        <div style="width: 100%; background: rgba(255,255,255,0.3); border-radius: 10px; height: 8px; overflow: hidden;">
          <div id="quizProgressBar" style="width: 0%; background: white; height: 100%; border-radius: 10px; transition: width 0.5s;"></div>
        </div>
      </div>

      <div style="background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
        <h3 id="quizQuestionText" style="color: #1f2937; margin-bottom: 25px; font-size: 22px; line-height: 1.6;"></h3>

        <div id="quizOptionsContainer" style="display: flex; flex-direction: column; gap: 12px; margin-bottom: 25px;">
          <!-- Options will be inserted here -->
        </div>

        <button onclick="nextQuizQuestion()" id="quizNextBtn" disabled style="width: 100%; padding: 15px; font-size: 16px; font-weight: 600;">
          <span id="quizNextBtnText">Keyingi Savol</span>
          <i class="bi bi-chevron-right"></i>
        </button>
      </div>
    </div>

    <!-- Quiz Results Section -->
    <div id="quizResultsSection" style="display: none; margin-top: 30px;">
      <div style="background: white; padding: 40px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); text-align: center;">
        <div style="display: inline-flex; align-items: center; justify-content: center; width: 100px; height: 100px; background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%); border-radius: 50%; margin-bottom: 20px; animation: bounce 1s infinite;">
          <i class="bi bi-trophy-fill" style="font-size: 50px; color: white;"></i>
        </div>
        
        <h2 style="color: #1f2937; margin-bottom: 15px; font-size: 32px;">Natijalar / Results</h2>
        <div id="quizScoreDisplay" style="font-size: 60px; font-weight: bold; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin-bottom: 10px;">
          0/0
        </div>
        <div id="quizPercentageDisplay" style="font-size: 24px; color: #6b7280; margin-bottom: 30px;">
          0% to'g'ri!
        </div>

        <div id="quizAnswersReview" style="text-align: left; margin: 30px 0; padding: 20px; background: #f9fafb; border-radius: 12px;">
          <!-- Detailed answers will be inserted here -->
        </div>

        <button onclick="resetQuiz()" style="width: 100%; padding: 15px; font-size: 16px; font-weight: 600;">
          <i class="bi bi-arrow-clockwise"></i> Yangi Quiz Yaratish / New Quiz
        </button>
      </div>
    </div>
  </div>
</div>

<!-- STUDY ASSISTANT TOOL -->
<div class="tool-content" id="clinical_notes-content">
  <div class="tool-interface">
    <h4 style="margin-bottom: 15px; color: #1f2937">
      <i class="bi bi-mortarboard"></i> Study Assistant
    </h4>
    <p style="color: #6b7280; margin-bottom: 20px;">O'qishda yordam beruvchi AI assistent - rejim tanlang va boshlang!</p>

    <!-- Mode tanlash tugmalari -->
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(130px, 1fr)); gap: 12px; margin-bottom: 25px;">
      
      <button class="study-mode-btn" onclick="selectStudyMode('explain')" style="display: flex; flex-direction: column; align-items: center; gap: 8px; padding: 16px 12px; border: 2px solid #e5e7eb; border-radius: 12px; background: #fff; cursor: pointer; transition: all 0.3s ease;">
        <i class="bi bi-lightbulb" style="font-size: 24px; color: #6366f1;"></i>
        <span style="font-size: 12px; font-weight: 600; color: #374151;">Explain Topic</span>
      </button>
      
      <button class="study-mode-btn" onclick="selectStudyMode('notes')" style="display: flex; flex-direction: column; align-items: center; gap: 8px; padding: 16px 12px; border: 2px solid #e5e7eb; border-radius: 12px; background: #fff; cursor: pointer; transition: all 0.3s ease;">
        <i class="bi bi-journal-text" style="font-size: 24px; color: #10b981;"></i>
        <span style="font-size: 12px; font-weight: 600; color: #374151;">Make Notes</span>
      </button>
      
      <button class="study-mode-btn" onclick="selectStudyMode('quiz')" style="display: flex; flex-direction: column; align-items: center; gap: 8px; padding: 16px 12px; border: 2px solid #e5e7eb; border-radius: 12px; background: #fff; cursor: pointer; transition: all 0.3s ease;">
        <i class="bi bi-question-circle" style="font-size: 24px; color: #f59e0b;"></i>
        <span style="font-size: 12px; font-weight: 600; color: #374151;">Quiz Maker</span>
      </button>
      
      <button class="study-mode-btn" onclick="selectStudyMode('plan')" style="display: flex; flex-direction: column; align-items: center; gap: 8px; padding: 16px 12px; border: 2px solid #e5e7eb; border-radius: 12px; background: #fff; cursor: pointer; transition: all 0.3s ease;">
        <i class="bi bi-calendar-week" style="font-size: 24px; color: #ec4899;"></i>
        <span style="font-size: 12px; font-weight: 600; color: #374151;">Learning Plan</span>
      </button>
      
      <button class="study-mode-btn" onclick="selectStudyMode('mistakes')" style="display: flex; flex-direction: column; align-items: center; gap: 8px; padding: 16px 12px; border: 2px solid #e5e7eb; border-radius: 12px; background: #fff; cursor: pointer; transition: all 0.3s ease;">
        <i class="bi bi-x-circle" style="font-size: 24px; color: #ef4444;"></i>
        <span style="font-size: 12px; font-weight: 600; color: #374151;">Explain Mistakes</span>
      </button>
      
      <button class="study-mode-btn" onclick="selectStudyMode('flashcards')" style="display: flex; flex-direction: column; align-items: center; gap: 8px; padding: 16px 12px; border: 2px solid #e5e7eb; border-radius: 12px; background: #fff; cursor: pointer; transition: all 0.3s ease;">
        <i class="bi bi-card-text" style="font-size: 24px; color: #8b5cf6;"></i>
        <span style="font-size: 12px; font-weight: 600; color: #374151;">Flashcards</span>
      </button>
      
      <button class="study-mode-btn" onclick="selectStudyMode('script')" style="display: flex; flex-direction: column; align-items: center; gap: 8px; padding: 16px 12px; border: 2px solid #e5e7eb; border-radius: 12px; background: #fff; cursor: pointer; transition: all 0.3s ease;">
        <i class="bi bi-mic" style="font-size: 24px; color: #06b6d4;"></i>
        <span style="font-size: 12px; font-weight: 600; color: #374151;">Speaking/Writing</span>
      </button>
      
    </div>

    <!-- Til tanlash -->
    <div class="language-selector" style="margin-bottom: 20px;">
      <label for="study-language">ğŸŒ Til / Language / Ğ¯Ğ·Ñ‹Ğº:</label>
      <select id="study-language" class="language-dropdown">
        <option value="uz" selected>ğŸ‡ºğŸ‡¿ O'zbek</option>
        <option value="ru">ğŸ‡·ğŸ‡º Ğ ÑƒÑÑĞºĞ¸Ğ¹</option>
        <option value="en">ğŸ‡¬ğŸ‡§ English</option>
      </select>
    </div>

    <!-- Tanlangan mode ko'rsatish -->
    <div id="selectedModeDisplay" style="display: none; margin-bottom: 15px; padding: 12px 16px; background: linear-gradient(135deg, #667eea15, #764ba215); border-radius: 10px; border-left: 4px solid #6366f1;">
      <span style="font-weight: 600; color: #4b5563;">ğŸ“Œ Tanlangan rejim: </span>
      <span id="selectedModeName" style="color: #6366f1; font-weight: 700;"></span>
    </div>

    <!-- Input maydoni -->
    <textarea
      id="studyInput"
      placeholder="Avval yuqoridan rejim tanlang..."
      style="min-height: 150px;"
    ></textarea>

    <!-- Tugmalar -->
    <div style="display: flex; gap: 12px; margin-top: 20px;">
      <button onclick="submitStudyAssistant()" style="flex: 1;">
        <i class="bi bi-send"></i> Yuborish
      </button>
      <button onclick="clearStudyAssistant()" style="flex: 0.4; background: #6b7280;">
        <i class="bi bi-trash"></i> Tozalash
      </button>
    </div>

    <!-- Natija -->
    <div class="result-box" id="studyResult" style="display: none; margin-top: 25px;">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
        <h5 style="color: #1f2937; margin: 0;">
          <i class="bi bi-check-circle-fill" style="color: #10b981;"></i> Natija:
        </h5>
        <!-- <button onclick="copyStudyResult()" style="padding: 8px 16px; font-size: 14px; background: #6366f1;">
          <i class="bi bi-clipboard"></i> Nusxa
        </button> -->
      </div>
      <div id="studyOutput"></div>
    </div>
  </div>
</div>

<!-- SPEAKING FEEDBACK TOOL -->
<div class="tool-content" id="chat_bubble-content">
  <div class="tool-interface">
    <h4 style="margin-bottom: 15px; color: #1f2937">
      <i class="bi bi-mic-fill"></i> IELTS / CEFR Speaking Feedback
    </h4>
    <p style="color: #6b7280; margin-bottom: 20px;">
      Speaking javobingizni yozing yoki ovoz yozib oling â€” AI batafsil feedback beradi!
    </p>

    <!-- Exam Type Tanlash -->
    <div style="margin-bottom: 25px;">
      <label style="display: block; margin-bottom: 10px; color: #374151; font-weight: 600;">
        ğŸ“‹ Imtihon Turini Tanlang:
      </label>
      <div style="display: flex; gap: 15px;">
        <button 
          class="exam-type-btn" 
          onclick="selectExamType('IELTS')"
          style="flex: 1; padding: 20px; border: 2px solid #e5e7eb; border-radius: 12px; background: #fff; cursor: pointer; transition: all 0.3s ease;">
          <div style="font-size: 32px; margin-bottom: 8px;">ğŸ“</div>
          <div style="font-weight: 700; font-size: 18px; color: #1f2937;">IELTS</div>
          <div style="font-size: 12px; color: #6b7280; margin-top: 5px;">Band 1-9</div>
        </button>
        
        <button 
          class="exam-type-btn" 
          onclick="selectExamType('Multilevel')"
          style="flex: 1; padding: 20px; border: 2px solid #e5e7eb; border-radius: 12px; background: #fff; cursor: pointer; transition: all 0.3s ease;">
          <div style="font-size: 32px; margin-bottom: 8px;">ğŸ“‘</div>
          <div style="font-weight: 700; font-size: 18px; color: #1f2937;">Multilevel</div>
          <div style="font-size: 12px; color: #6b7280; margin-top: 5px;">0-75 ball (A1-C1)</div>
        </button>
      </div>
      <!-- <div id="examInfoText" style="margin-top: 12px; padding: 12px; background: #f3f4f6; border-radius: 8px; font-size: 14px; color: #4b5563;">
        ğŸ“Š Imtihon turini tanlang
      </div> -->
    </div>

    <!-- Til Tanlash -->
    <div class="language-selector" style="margin-bottom: 20px;">
      <label for="speaking-language">ğŸŒ Til / Language / Ğ¯Ğ·Ñ‹Ğº:</label>
      <select id="speaking-language" class="language-dropdown">
        <option value="uz" selected>ğŸ‡ºğŸ‡¿ O'zbek</option>
        <option value="ru">ğŸ‡·ğŸ‡º Ğ ÑƒÑÑĞºĞ¸Ğ¹</option>
        <option value="en">ğŸ‡¬ğŸ‡§ English</option>
      </select>
    </div>

    <!-- Topic Input -->
    <div style="margin-bottom: 20px;">
      <label style="display: block; margin-bottom: 8px; color: #374151; font-weight: 600;">
        ğŸ“ Speaking Topic:
      </label>
      <input 
        type="text" 
        id="speakingTopicInput"
        placeholder="Masalan: Describe your favorite place to visit..."
        style="width: 100%; padding: 15px; border: 2px solid #e5e7eb; border-radius: 12px; font-size: 15px;"
      />
    </div>

    <!-- Ovoz Yozish -->
    <div style="background: linear-gradient(135deg, #667eea15, #764ba215); padding: 25px; border-radius: 16px; margin-bottom: 25px;">
      <h5 style="margin: 0 0 15px 0; color: #374151;">
        <i class="bi bi-mic"></i> Ovoz Yozish
      </h5>
      
      <div style="display: flex; flex-direction: column; align-items: center; gap: 15px;">
        <!-- Start Record Button -->
        <button 
          id="startRecordBtn"
          onclick="startRecording()"
          style="width: 80px; height: 80px; border-radius: 50%; background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); border: none; cursor: pointer; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 15px rgba(239, 68, 68, 0.4); transition: all 0.3s ease;">
          <i class="bi bi-mic-fill" style="font-size: 32px; color: white;"></i>
        </button>
        
        <!-- Stop Record Button -->
        <button 
          id="stopRecordBtn"
          onclick="stopRecording()"
          style="display: none; width: 80px; height: 80px; border-radius: 50%; background: linear-gradient(135deg, #6b7280 0%, #4b5563 100%); border: none; cursor: pointer; align-items: center; justify-content: center; box-shadow: 0 4px 15px rgba(107, 114, 128, 0.4); transition: all 0.3s ease;">
          <i class="bi bi-stop-fill" style="font-size: 32px; color: white;"></i>
        </button>
        
        <!-- Recording Status -->
        <div id="recordingStatus" style="display: none; align-items: center; gap: 10px;">
          <div style="width: 12px; height: 12px; background: #ef4444; border-radius: 50%; animation: pulse 1s infinite;"></div>
          <span style="color: #ef4444; font-weight: 600;">Recording...</span>
          <span id="recordingTime" style="color: #374151; font-weight: 700;">00:00</span>
        </div>
        
        <p style="margin: 0; color: #6b7280; font-size: 14px; text-align: center;">
          ğŸ¤ Tugmani bosib gapiring, tugatgach yana bosing
        </p>
      </div>
    </div>

    <!-- Yoki Text Kiritish -->
    <div style="position: relative; text-align: center; margin: 25px 0;">
      <hr style="border-color: #e5e7eb;">
      <span class="style-bc" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 0 15px; color: #9ca3af; font-weight: 600;">
        YOKI
      </span>
    </div>

    <!-- Text Input -->
    <div style="margin-bottom: 20px;">
      <label style="display: block; margin-bottom: 8px; color: #374151; font-weight: 600;">
        âœï¸ Javobingizni Yozing:
      </label>
      <textarea 
        id="speakingTextInput"
        placeholder="Speaking javobingizni shu yerga yozing..."
        style="min-height: 150px;"
      ></textarea>
    </div>

    <!-- Tugmalar -->
    <div style="display: flex; gap: 12px;">
      <button onclick="submitSpeakingText()" style="flex: 1;">
        <i class="bi bi-send"></i> Feedback Olish
      </button>
      <button onclick="clearSpeaking()" style="flex: 0.4; background: #6b7280;">
        <i class="bi bi-trash"></i> Tozalash
      </button>
    </div>

    <!-- Natija -->
    <div class="result-box" id="speakingResult" style="display: none; margin-top: 25px;">
      <div id="speakingOutput"></div>
    </div>
  </div>
</div>

<!-- PROFILE TOOL -->
<div class="tool-content" id="profile-content">
  <div class="profile-container-inline">
    
    <!-- Profile Header -->
    <div class="profile-header-inline">
      <div class="profile-avatar-section-inline">
        <div class="profile-avatar-inline" id="profileAvatar" onclick="openAvatarModal()">
          ğŸ‘¤
        </div>
        <button class="avatar-edit-btn-inline" onclick="openAvatarModal()">
          <i class="bi bi-pencil-fill"></i>
        </button>
      </div>
      <div class="profile-name-inline" id="profileName">Loading...</div>
      <div class="profile-email-inline" id="profileEmail">Loading...</div>
      <div class="profile-date-inline" id="profileDate">
        <i class="bi bi-calendar3"></i> Member since: Loading...
      </div>
    </div>

    <!-- Profile Body -->
    <div class="profile-body-inline">
      <!-- Account Information -->
      <div class="profile-section-inline">
        <div class="section-title-inline">
          <i class="bi bi-person-circle"></i>
          Account Information
        </div>

        <div class="input-group-inline">
          <label>Username</label>
          <input type="text" id="usernameInput" placeholder="Enter your username">
        </div>

        <div class="input-group-inline">
          <label>Email Address</label>
          <input type="email" id="emailInput" disabled placeholder="your@email.com">
        </div>

        <button class="btn-inline btn-primary-inline" onclick="updateUsername()">
          <i class="bi bi-check-circle"></i> Save Changes
        </button>
      </div>

      <!-- Settings -->
      <div class="profile-section-inline">
        <div class="section-title-inline">
          <i class="bi bi-gear-fill"></i>
          Settings
        </div>

        <div class="theme-toggle-inline">
          <div class="theme-toggle-label-inline">
            <i class="bi bi-moon-stars-fill"></i>
            <span>Dark Mode</span>
          </div>
          <label class="switch-inline">
            <input type="checkbox" id="darkModeToggle" onchange="toggleDarkMode()">
            <span class="slider-inline"></span>
          </label>
        </div>

        <button class="btn-inline btn-secondary-inline" onclick="openPasswordModal()" style="width: 100%; margin-top: 15px;">
          <i class="bi bi-lock-fill"></i> Change Password
        </button>
      </div>

      <!-- Danger Zone -->
      <div class="danger-zone-inline">
        <div class="danger-zone-title-inline">
          <i class="bi bi-exclamation-triangle-fill"></i>
          Danger Zone
        </div>
        <div class="danger-zone-actions-inline">
          <button class="btn-inline btn-secondary-inline" onclick="exportData()">
            <i class="bi bi-download"></i> Export Data
          </button>
          <button class="btn-inline btn-danger-inline" onclick="openDeleteModal()">
            <i class="bi bi-trash-fill"></i> Delete Account
          </button>
        </div>
      </div>
    </div>

  </div>
</div>

<!-- Avatar Modal -->
<div class="modal-overlay-inline" id="avatarModal">
  <div class="modal-inline">
    <div class="modal-header-inline">
      <h3>Choose Avatar</h3>
      <button class="modal-close-inline" onclick="closeAvatarModal()">Ã—</button>
    </div>
    <div class="modal-body-inline">
      <p style="color: #6b7280; margin-bottom: 10px;">Select an emoji as your profile picture:</p>
      <div class="emoji-grid-inline" id="emojiGrid">
        <!-- Emojis will be generated by JS -->
      </div>
    </div>
    <div class="modal-footer-inline">
      <button class="btn-inline btn-secondary-inline" onclick="closeAvatarModal()">Cancel</button>
      <button class="btn-inline btn-primary-inline" onclick="saveAvatar()">
        <i class="bi bi-check-circle"></i> Save
      </button>
    </div>
  </div>
</div>

<!-- Password Modal -->
<div class="modal-overlay-inline" id="passwordModal">
  <div class="modal-inline">
    <div class="modal-header-inline">
      <h3>Change Password</h3>
      <button class="modal-close-inline" onclick="closePasswordModal()">Ã—</button>
    </div>
    <div class="modal-body-inline">
      <div class="input-group-inline">
        <label>Current Password</label>
        <input type="password" id="currentPassword" placeholder="Enter current password">
      </div>
      <div class="input-group-inline">
        <label>New Password</label>
        <input type="password" id="newPassword" placeholder="Enter new password">
      </div>
      <div class="input-group-inline">
        <label>Confirm New Password</label>
        <input type="password" id="confirmPassword" placeholder="Confirm new password">
      </div>
    </div>
    <div class="modal-footer-inline">
      <button class="btn-inline btn-secondary-inline" onclick="closePasswordModal()">Cancel</button>
      <button class="btn-inline btn-primary-inline" onclick="changePassword()">
        <i class="bi bi-check-circle"></i> Update Password
      </button>
    </div>
  </div>
</div>

<!-- Delete Account Modal -->
<div class="modal-overlay-inline" id="deleteModal">
  <div class="modal-inline">
    <div class="modal-header-inline">
      <h3 style="color: #dc2626;">Delete Account</h3>
      <button class="modal-close-inline" onclick="closeDeleteModal()">Ã—</button>
    </div>
    <div class="modal-body-inline">
      <p style="color: #6b7280; margin-bottom: 15px;">
        <strong>Warning:</strong> This action cannot be undone. All your data will be permanently deleted.
      </p>
      <div class="input-group-inline">
        <label>Type "DELETE" to confirm</label>
        <input type="text" id="deleteConfirm" placeholder="Type DELETE">
      </div>
    </div>
    <div class="modal-footer-inline">
      <button class="btn-inline btn-secondary-inline" onclick="closeDeleteModal()">Cancel</button>
      <button class="btn-inline btn-danger-inline" onclick="deleteAccount()">
        <i class="bi bi-trash-fill"></i> Delete Forever
      </button>
    </div>
  </div>
</div>

      
    </main>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>
    
    <script src="../JS/dashboard.js"></script>
    <script src="../JS/profile.js"></script>

    <!-- Firebase Auth -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { 
    getAuth, 
    signOut, 
    onAuthStateChanged,
    updateProfile,
    updateEmail,
    updatePassword,
    deleteUser,
    reauthenticateWithCredential,
    EmailAuthProvider
  } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

  const firebaseConfig = {
    apiKey: "AIzaSyA_w0n84YFtUYZgZodCn52lfYiqkL6v1HM",
    authDomain: "zioai-96e9f.firebaseapp.com",
    projectId: "zioai-96e9f",
    storageBucket: "zioai-96e9f.firebasestorage.app",
    messagingSenderId: "766076125152",
    appId: "1:766076125152:web:9cd609efb7895386547585"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);

  // Global variables uchun
  window.firebaseAuth = auth;
  window.updateProfile = updateProfile;
  window.updateEmail = updateEmail;
  window.updatePassword = updatePassword;
  window.deleteUser = deleteUser;
  window.reauthenticateWithCredential = reauthenticateWithCredential;
  window.EmailAuthProvider = EmailAuthProvider;
  window.getAuth = getAuth;

  // ============================================
  // DYNAMIC USERNAME FUNCTION - FIXED âœ…
  // ============================================
  function updateUserName(user) {
    console.log("User displayName:", user.displayName);
    console.log("User email:", user.email);
    
    const userNameElement = document.getElementById('userName');
    if (user && userNameElement) {
      // Emoji ni olib tashlash va faqat username ni ko'rsatish
      const displayName = user.displayName 
        ? user.displayName.replace(/[\u{1F300}-\u{1F9FF}]/gu, '').trim() 
        : user.email.split('@')[0];
      userNameElement.textContent = displayName;
    }
  }

  // ============================================
  // AUTH STATE CHANGED - YANGILANGAN
  // ============================================
  onAuthStateChanged(auth, (user) => {
    if (user) {
      console.log("âœ… User logged in:", user.email);
      console.log("ğŸ“ Display Name:", user.displayName);
      console.log("ğŸ‘¤ UID:", user.uid);
      
      // USERNAME NI YANGILASH
      updateUserName(user);
      
      // Spinner ni yashirish
      document.querySelector(".spinner-wrapper").style.display = "none";
    } else {
      console.log("âŒ No user logged in");
      window.location.href = "./login.html";
    }
  });

  // ============================================
  // LOGOUT FUNCTIONALITY
  // ============================================
  const logoutBtn = document.getElementById("logoutBtn");
  const logoutModal = document.getElementById("logoutModal");
  const cancelLogout = document.getElementById("cancelLogout");
  const confirmLogout = document.getElementById("confirmLogout");

  logoutBtn?.addEventListener("click", (e) => {
    e.preventDefault();
    logoutModal.classList.add("active");
  });

  cancelLogout?.addEventListener("click", () => {
    logoutModal.classList.remove("active");
  });

  confirmLogout?.addEventListener("click", async () => {
    try {
      await signOut(auth);
      console.log("âœ… User signed out");
      window.location.href = "./login.html";
    } catch (error) {
      console.error("âŒ Logout error:", error);
      alert("Logout error: " + error.message);
    }
  });
</script>
<style>
@keyframes slideIn {
  from {
    transform: translateX(400px);
    opacity: 0;
  }
  to {
    transform: translateX(0);
    opacity: 1;
  }
}

@keyframes slideOut {
  from {
    transform: translateX(0);
    opacity: 1;
  }
  to {
    transform: translateX(400px);
    opacity: 0;
  }
}
</style>
  </body>
</html>